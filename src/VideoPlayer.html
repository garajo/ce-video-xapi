<slot></slot>
<!-- Why is the below element not available oncreate? -->
<div class="loc_player"></div>

<quiz-component></quiz-component>


<style>
  :host {
    border: 1px solid #666;
    box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    display: block;
    padding: 0.5em 1em;
    border-radius: 2px;
    margin: 0 0 1em 0;
  }

  p {
    color: blue;
  }
</style>

<script src="https://www.youtube.com/iframe_api"></script>

<script>

  export default {
    tag: 'ce-video',

    oncreate() {
      // // why doesn't the effin below work?
      // console.log('WTF:', document.getElementsByClassName('loc_player'))
      // const wtfdebug = document.getElementsByTagName("div")
      
      const component = this
      var player;
      
      var tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      document.body.appendChild(tag)

      window.onYouTubeIframeAPIReady = function() {
        const { videoid, playerid, data } = component.get()
        
        // console.log('data', data)

        if (document.getElementById(playerid) === null) alert('missing "player" id element')
        
        player = new YT.Player(playerid, {
          height: '390',
          width: '640',
          videoId: videoid,
          playerVars: { 'controls': 1 },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      // 4. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
        event.target.playVideo();
      }

      // 5. The API calls this function when the player's state changes.
      //    The function indicates that when playing a video (state=1),
      //    the player should play for six seconds and then stop.
      var done = false;

      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING && !done) {
          setTimeout(stopVideo, 1000);
          done = true;
        }

        // console.log('onPlayerStateCHange')      
        // console.log('event', event)
        // console.log('component', component)
        
        
      }

      function stopVideo() {
        player.stopVideo();
      }

    },
  };
</script>